import{r as n,j as e,a as I,J as X,f as G}from"./app-CM_53ag-.js";import{A as H,T as K}from"./AuthenticatedLayout-D4R4wwZx.js";import{R as Q}from"./RequestDetailModal-d0WLdaZz.js";import{S as W}from"./search-C60bdz9-.js";import{F as Y}from"./funnel-BE2sA641.js";import{F as Z}from"./file-text-BuT2rTD0.js";import{C as N}from"./circle-alert-x6lWoPzX.js";import{M as q}from"./map-pin-CuCzhjHC.js";import{a as ee,C as se,U as ae}from"./users-DYKfnPp_.js";import{C as te}from"./car-Cbx68Keb.js";import{U as re}from"./user-Bqgk2e5v.js";import{E as ne}from"./eye-CaPjzHpH.js";import{C as w}from"./circle-check-big-CyQMP5RP.js";import{C as le}from"./circle-x-C_tTjCxK.js";import{f as D}from"./format-zWY_uF1i.js";import"./Dropdown-NYFviwhB.js";import"./transition-CF6lRaLe.js";import"./portal-N1CzU3lS.js";import"./createLucideIcon-mPmu35-0.js";import"./x-C1RpThLZ.js";function ze({auth:_,pendingRequests:x,assignedRequests:g,approvedRequests:p,completedRequests:h,forwardedRequests:u,declinedRequests:f,vehicles:C,drivers:S}){const[a,z]=n.useState("pending"),[l,A]=n.useState(""),[o,$]=n.useState("all"),[c,M]=n.useState("all"),[T,j]=n.useState(null),[L,v]=n.useState(!1),R=[{id:"pending",label:"Pending",count:x.length,color:"blue"},{id:"assigned",label:"Assigned",count:g.length,color:"yellow"},{id:"approved",label:"Approved",count:p.length,color:"green"},{id:"completed",label:"Completed",count:h.length,color:"purple"},{id:"forwarded",label:"Forwarded for Decline",count:u.length,color:"orange"},{id:"declined",label:"Declined",count:f.length,color:"red"}],b=(()=>{switch(a){case"pending":return x;case"assigned":return g;case"approved":return p;case"completed":return h;case"forwarded":return u;case"declined":return f;default:return[]}})(),m=b.filter(s=>{const t=s.destination.toLowerCase().includes(l.toLowerCase())||s.purpose.toLowerCase().includes(l.toLowerCase())||s.user.name.toLowerCase().includes(l.toLowerCase()),i=o==="all"||s.vehicle_id&&s.vehicle_id.toString()===o,r=c==="all"||s.driver_id&&s.driver_id.toString()===c;return t&&i&&r}),F=s=>new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),U=s=>D(new Date(s),"MMMM d, yyyy"),V=s=>D(new Date(`2000-01-01 ${s}`),"h:mm a"),y=s=>{const t=new Date,r=new Date(s)-t;return Math.ceil(r/(1e3*60*60*24))},k=s=>{const t=y(s);return t<0?"bg-red-100 text-red-800":t<=1?"bg-orange-100 text-orange-800":t<=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"},E=s=>{confirm("Are you sure you want to unassign this request? This will remove the vehicle and driver assignment.")&&G.delete(route("assignment.requests.unassign",s))},O=s=>{j(s),v(!0)},P=()=>{v(!1),j(null)},B=s=>{const t={pending:"bg-blue-100 text-blue-800",assigned:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",completed:"bg-purple-100 text-purple-800",declined:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t[s]||"bg-gray-100 text-gray-800"}`,children:s.charAt(0).toUpperCase()+s.slice(1)})},J=s=>({blue:"border-blue-500 text-blue-600",yellow:"border-yellow-500 text-yellow-600",green:"border-green-500 text-green-600",purple:"border-purple-500 text-purple-600",orange:"border-orange-500 text-orange-600",red:"border-red-500 text-red-600"})[s]||"border-gray-500 text-gray-600";return e.jsxs(H,{user:_.user,header:e.jsx("div",{className:"flex justify-between items-center gap-4",children:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Request Management"})}),children:[e.jsx(I,{title:"Request Management"}),e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200 overflow-x-auto",children:e.jsx("nav",{className:"-mb-px flex",children:R.map(s=>e.jsxs("button",{onClick:()=>z(s.id),className:`py-4 px-6 text-sm font-medium whitespace-nowrap ${a===s.id?`border-b-2 ${J(s.color)}`:"text-gray-500 hover:text-gray-700"}`,children:[s.label," (",s.count,")"]},s.id))})}),e.jsx("div",{className:"p-6 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search by destination, purpose, or requester...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:l,onChange:s=>A(s.target.value)})]})}),(a==="assigned"||a==="approved"||a==="completed")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:16,className:"text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",value:o,onChange:s=>$(s.target.value),children:[e.jsx("option",{value:"all",children:"All Vehicles"}),C.map(s=>e.jsxs("option",{value:s.id,children:[s.model," - ",s.plate_number]},s.id))]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",value:c,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"all",children:"All Drivers"}),S.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:m.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(Z,{size:48,className:"mx-auto"})}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:["No ",a," requests found"]}),e.jsx("p",{className:"text-gray-600",children:l||o!=="all"||c!=="all"?"No requests match your search criteria.":`There are no ${a} requests at the moment.`})]}):m.map(s=>{var t,i,r;return e.jsx("div",{className:`p-6 hover:bg-gray-50 transition ${s.forwarded_for_decline?"bg-orange-50":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.user.name}),B(s.status),s.forwarded_for_decline===!0&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:[e.jsx(N,{size:12,className:"mr-1"}),"Forwarded for Decline"]}),a==="pending"&&(()=>{const d=y(s.start_datetime);return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${k(s.start_datetime)}`,children:d<0?"Overdue":d===0?"Today":d===1?"Tomorrow":`${d} days`})})()]}),a==="pending"&&e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:[s.user.department||"N/A"," - ",s.user.position||"N/A"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:16,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Destination:"}),e.jsx("span",{className:"ml-2 text-gray-700",children:s.destination})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{size:16,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{className:"ml-2 text-gray-700",children:a==="pending"?`${U(s.date_of_travel)} at ${V(s.time_of_travel)}`:F(s.start_datetime)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:16,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"}),e.jsxs("span",{className:"ml-2 text-gray-700",children:[s.days_of_travel," day(s)"]})]})]}),(a==="assigned"||a==="approved"||a==="completed")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{size:16,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vehicle:"}),e.jsxs("span",{className:"ml-2 text-gray-700",children:[((t=s.vehicle)==null?void 0:t.model)||"—"," - ",((i=s.vehicle)==null?void 0:i.plate_number)||"—"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:16,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Driver:"}),e.jsx("span",{className:"ml-2 text-gray-700",children:((r=s.driver)==null?void 0:r.name)||"—"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:16,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Passengers:"}),e.jsx("span",{className:"ml-2 text-gray-700",children:s.authorized_passengers})]})]})]}),s.purpose&&e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Purpose:"}),e.jsx("p",{className:"text-gray-600 mt-1 leading-relaxed",children:s.purpose})]}),s.forwarded_for_decline===!0&&s.forwarded_decline_reason&&e.jsxs("div",{className:"mb-4 p-3 bg-orange-100 border border-orange-200 rounded-md",children:[e.jsx("span",{className:"font-medium text-orange-900 text-sm",children:"Reason for Forwarding:"}),e.jsxs("p",{className:"text-orange-800 text-sm mt-1 italic",children:['"',s.forwarded_decline_reason,'"']})]}),a==="declined"&&s.decline_reason&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-200 rounded-md",children:[e.jsx("span",{className:"font-medium text-red-900 text-sm",children:"Decline Reason:"}),e.jsx("p",{className:"text-red-800 text-sm mt-1",children:s.decline_reason})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a==="pending"&&`Submitted on ${new Date(s.created_at).toLocaleDateString()}`,a==="assigned"&&s.assignment&&`Assigned on ${new Date(s.assignment.created_at).toLocaleDateString()}`,a==="approved"&&s.approved_at&&`Approved on ${new Date(s.approved_at).toLocaleDateString()}`,a==="completed"&&`Completed on ${new Date(s.end_datetime).toLocaleDateString()}`,a==="declined"&&s.declined_at&&`Declined on ${new Date(s.declined_at).toLocaleDateString()}`,a==="forwarded"&&s.updated_at&&`Forwarded on ${new Date(s.updated_at).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"ml-6 flex flex-col gap-2",children:[e.jsxs("button",{onClick:()=>O(s),className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition text-sm flex items-center gap-2 whitespace-nowrap",children:[e.jsx(ne,{size:14}),"View Details"]}),a==="pending"&&e.jsx(X,{href:route("assignment.requests.assign.view",s.id),className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition font-medium text-center",children:"Assign Vehicle & Driver"}),a==="assigned"&&!s.forwarded_for_decline&&e.jsxs("button",{onClick:()=>E(s.id),className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition text-sm flex items-center gap-1",children:[e.jsx(K,{size:14}),"Unassign"]}),a==="forwarded"&&e.jsxs("div",{className:"flex items-center gap-2 text-orange-600 bg-orange-100 px-4 py-2 rounded-md",children:[e.jsx(N,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Awaiting Decline"})]}),a==="approved"&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(w,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Approved"})]}),a==="completed"&&e.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[e.jsx(w,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Completed"})]}),a==="declined"&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(le,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Declined"})]})]})]})},s.id)})}),m.length>0&&e.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",m.length," of ",b.length," ",a," requests"]})})]})})}),e.jsx(Q,{isOpen:L,onClose:P,request:T})]})}export{ze as default};
