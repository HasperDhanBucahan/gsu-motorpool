import{r as o,d as v,j as e,f as $}from"./app-CM_53ag-.js";import I from"./RequestDetailModal-DFPzcRTk.js";import{a as R}from"./users-DYKfnPp_.js";import{E as W}from"./eye-CaPjzHpH.js";import{C as A}from"./chevron-left-DJaHbXH1.js";import{c as J}from"./createLucideIcon-mPmu35-0.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],_=J("chevron-right",L);function Q({userRole:x}){const[a,g]=o.useState(new Date),[i,j]=o.useState([]),[y,N]=o.useState(null),[w,p]=o.useState(!1),[u,b]=o.useState(!1);console.log("CalendarWidget userRole:",x),console.log("Events loaded:",i.length),o.useEffect(()=>{D()},[a]);const D=async()=>{b(!0);try{const t=new Date(a.getFullYear(),a.getMonth(),1),s=new Date(a.getFullYear(),a.getMonth()+1,0),l=await v.get("/calendar/events",{params:{start:t.toISOString(),end:s.toISOString()}});j(l.data)}catch(t){console.error("Failed to fetch events:",t)}finally{b(!1)}},M=async t=>{try{const s=await v.get(`/calendar/requests/${t}`);N(s.data),p(!0)}catch(s){console.error("Failed to fetch request details:",s),alert("Failed to load request details")}},C=()=>{const t=a.getFullYear(),s=a.getMonth(),l=new Date(t,s,1),d=new Date(t,s+1,0),h=l.getDay(),r=d.getDate(),c=[];for(let n=0;n<h;n++)c.push({date:null,isCurrentMonth:!1});for(let n=1;n<=r;n++){const f=new Date(t,s,n),Y=i.filter(q=>{const m=new Date(q.start);return m.getDate()===n&&m.getMonth()===s&&m.getFullYear()===t});c.push({date:n,fullDate:f,isCurrentMonth:!0,isToday:F(f),events:Y})}return c},F=t=>{const s=new Date;return t.getDate()===s.getDate()&&t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()},S=()=>{g(new Date(a.getFullYear(),a.getMonth()-1))},T=()=>{g(new Date(a.getFullYear(),a.getMonth()+1))},k=()=>{g(new Date)},E=["January","February","March","April","May","June","July","August","September","October","November","December"],O=C();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x==="client"?"My Trips":"Scheduled Trips"})]}),e.jsxs("button",{onClick:()=>$.visit(route("calendar.index")),className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"}),"Full Calendar"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:S,className:"p-1 hover:bg-white rounded transition",disabled:u,children:e.jsx(A,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:[E[a.getMonth()]," ",a.getFullYear()]}),e.jsx("button",{onClick:k,className:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"Today"})]}),e.jsx("button",{onClick:T,className:"p-1 hover:bg-white rounded transition",disabled:u,children:e.jsx(_,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"text-center text-xs font-semibold text-gray-600 py-2",children:t},t))}),u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsx("div",{className:"grid grid-cols-7 gap-1",children:O.map((t,s)=>{var l,d,h;return e.jsx("div",{className:`min-h-[60px] p-1 border rounded ${t.isCurrentMonth?t.isToday?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50":"bg-gray-50"} ${((l=t.events)==null?void 0:l.length)>0?"cursor-pointer":""}`,children:t.date&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-xs font-medium mb-1 ${t.isToday?"text-blue-600":"text-gray-700"}`,children:t.date}),e.jsxs("div",{className:"space-y-1",children:[(d=t.events)==null?void 0:d.slice(0,2).map((r,c)=>{var n;return e.jsx("div",{onClick:()=>M(r.id),className:"text-[10px] px-1 py-0.5 rounded truncate cursor-pointer hover:opacity-80 transition",style:{backgroundColor:r.backgroundColor,color:"white"},title:`${r.title} - ${((n=r.extendedProps)==null?void 0:n.formatted_duration)||""}`,children:r.title},c)}),((h=t.events)==null?void 0:h.length)>2&&e.jsxs("div",{className:"text-[10px] text-gray-500 px-1",children:["+",t.events.length-2," more"]})]})]})},s)})})]}),e.jsxs("div",{className:"px-4 pb-4 flex flex-wrap gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsx("span",{className:"text-gray-600",children:"Approved"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-purple-500"}),e.jsx("span",{className:"text-gray-600",children:"Completed"})]})]}),i.length>0&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-sm text-blue-900",children:[e.jsx("strong",{children:i.length})," ",i.length===1?"trip":"trips"," this month"]})})]}),e.jsx(I,{isOpen:w,closeModal:()=>p(!1),request:y,userRole:x})]})}export{Q as C};
