import{j as e,r as l,q,S as ee,a as se,f as F}from"./app-CM_53ag-.js";import{A as te}from"./AuthenticatedLayout-D4R4wwZx.js";import{X as ae}from"./x-C1RpThLZ.js";import{C as y}from"./circle-check-big-CyQMP5RP.js";import{z as R}from"./transition-CF6lRaLe.js";import{L as M}from"./dialog-D3HxsCPS.js";import{f as v}from"./format-zWY_uF1i.js";import{T as P}from"./triangle-alert-LBezGv4U.js";import{C as I}from"./car-Cbx68Keb.js";import{U as O}from"./user-Bqgk2e5v.js";import{C as re,a as ie,U as le}from"./users-DYKfnPp_.js";import{C as ne}from"./circle-x-C_tTjCxK.js";import{M as de}from"./map-pin-CuCzhjHC.js";import"./Dropdown-NYFviwhB.js";import"./portal-N1CzU3lS.js";import"./createLucideIcon-mPmu35-0.js";function ce({isOpen:o,closeModal:t,request:a,selectedVehicle:n,selectedDriver:m,assignmentAdmin:i,onConfirmAssignment:w,processing:r,previewUrl:S}){var j,x;if(!a||!n||!m)return null;const c=d=>{try{return v(new Date(d),"MMMM d, yyyy")}catch{return d}},p=d=>{try{return v(new Date(d),"MMMM d, yyyy h:mm a")}catch{return d}};return e.jsx(R,{appear:!0,show:o,as:l.Fragment,children:e.jsxs(M,{as:"div",className:"relative z-50",onClose:t,children:[e.jsx(R.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(M.Panel,{className:"w-full max-w-5xl transform overflow-hidden rounded-lg bg-white shadow-xl transition-all",children:[e.jsxs(M.Title,{as:"div",className:"flex items-center justify-between border-b p-4 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Assignment Preview"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-500",disabled:r,children:e.jsx(ae,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"border rounded-lg p-6 bg-white shadow-sm mb-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"VEHICLE ASSIGNMENT CONFIRMATION"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Request ID: REQ-",String(a.id).padStart(5,"0")]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3 border-b pb-2",children:"REQUEST INFORMATION"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Requestor:"}),e.jsx("p",{className:"font-medium",children:(j=a.user)==null?void 0:j.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Department:"}),e.jsx("p",{className:"font-medium",children:((x=a.user)==null?void 0:x.department)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Destination:"}),e.jsx("p",{className:"font-medium",children:a.destination})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Purpose:"}),e.jsx("p",{className:"font-medium",children:a.purpose})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3 border-b pb-2",children:"SCHEDULE"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Travel Date:"}),e.jsx("p",{className:"font-medium",children:c(a.date_of_travel)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Duration:"}),e.jsxs("p",{className:"font-medium",children:[a.days_of_travel," day(s)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Start:"}),e.jsx("p",{className:"font-medium",children:p(a.start_datetime)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"End:"}),e.jsx("p",{className:"font-medium",children:p(a.end_datetime)})]})]})]})]}),e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"ASSIGNMENT DETAILS"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-blue-700",children:"Assigned Vehicle:"}),e.jsx("p",{className:"font-medium text-blue-900",children:n.description}),e.jsx("p",{className:"text-sm text-blue-700",children:n.plate_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-blue-700",children:"Assigned Driver:"}),e.jsx("p",{className:"font-medium text-blue-900",children:m.name}),e.jsx("p",{className:"text-sm text-blue-700",children:m.contact_number})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3 border-b pb-2",children:"ASSIGNED BY"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Assignment Admin:"}),e.jsx("p",{className:"font-medium",children:i==null?void 0:i.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Assignment Date:"}),e.jsx("p",{className:"font-medium",children:v(new Date,"MMMM d, yyyy h:mm a")})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3 border-b pb-2",children:"PASSENGERS"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Authorized Passengers:"}),e.jsx("p",{className:"font-medium",children:a.authorized_passengers})]})]})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center pt-4 border-t",children:"This assignment will be sent to the Approval Admin for final approval"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"PDF Preview (Use PDF controls to download or print):"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",style:{height:"500px"},children:e.jsx("iframe",{src:S,className:"w-full h-full",title:"Assignment Confirmation PDF Preview"})})]}),e.jsxs("div",{className:"flex justify-between items-center gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 border rounded-md",disabled:r,children:"Go Back to Edit"}),e.jsxs("button",{onClick:w,className:"flex items-center gap-2 px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",disabled:r,children:[e.jsx(y,{className:"w-4 h-4"}),r?"Confirming Assignment...":"Confirm Assignment"]})]})]})]})})})]})})}const oe=o=>v(new Date(o),"MMMM d, yyyy h:mm a");function Ae({auth:o,request:t,availableVehicles:a,availableDrivers:n}){const{auth:m}=q().props,[i,w]=l.useState(""),[r,S]=l.useState(""),[c,p]=l.useState([]),[j,x]=l.useState(!1),[d,u]=l.useState(!1),[U,L]=l.useState(""),[$,C]=l.useState(!1),[h,D]=l.useState(""),[g,E]=l.useState(!1),{setData:k,post:V,processing:A,errors:b}=ee({vehicle_id:"",driver_id:""}),f=a.length===0,N=n.length===0,z=f||N;l.useEffect(()=>{i&&r&&G()},[i,r]);const G=async()=>{if(!(!i||!r)){x(!0);try{const _=await(await fetch(`/assignment/check-availability?vehicle_id=${i}&driver_id=${r}&start_datetime=${t.start_datetime}&end_datetime=${t.end_datetime}`)).json();p(_.conflicts||[])}catch(s){console.error("Error checking availability:",s)}finally{x(!1)}}},B=()=>{if(c.length>0){alert("Please resolve conflicts before previewing the assignment.");return}if(!i||!r){alert("Please select both a vehicle and a driver.");return}const s=route("assignment.requests.preview",{id:t.id,vehicle_id:i,driver_id:r});L(s),u(!0)},H=()=>{V(route("assignment.requests.assign",t.id),{onSuccess:()=>{u(!1)},onError:s=>{u(!1),console.error("Assignment errors:",s)}})},Q=s=>{w(s),k("vehicle_id",s)},X=s=>{S(s),k("driver_id",s)},Y=()=>{C(!0)},J=()=>{C(!1),D("")},K=()=>{if(!h.trim()){alert("Please provide a reason for declining.");return}E(!0),F.post(route("assignment.requests.forward-decline",t.id),{decline_reason:h.trim()},{preserveScroll:!0,onSuccess:()=>{console.log("Request forwarded to approval admin for declining"),C(!1),D("")},onError:s=>{console.error("Forward decline error:",s),s.decline_reason?alert("Decline reason error: "+s.decline_reason):s.error?alert("Error: "+s.error):alert("Failed to forward decline request. Please try again.")},onFinish:()=>{E(!1)}})},T=i&&r&&c.length===0&&!A,W=a.find(s=>s.id.toString()===i),Z=n.find(s=>s.id.toString()===r);return e.jsxs(te,{user:o.user,header:e.jsx("div",{className:"flex justify-between items-center gap-4",children:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Vehicle & Driver Assignment"})}),children:[e.jsx(se,{title:"Assign Vehicle & Driver"}),e.jsx("div",{className:"py-0",children:e.jsxs("div",{className:"max-w-0xl mx-auto sm:px-0 lg:px-0",children:[z&&e.jsx("div",{className:"mb-6 bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(P,{size:20,className:"text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-yellow-800",children:"No Resources Available"}),e.jsxs("p",{className:"text-yellow-700 text-sm mt-1",children:[f&&N&&"There are no vehicles or drivers available for this time period.",f&&!N&&"There are no vehicles available for this time period.",!f&&N&&"There are no drivers available for this time period."]}),e.jsx("p",{className:"text-yellow-700 text-sm mt-1",children:"You can forward this request to the approval admin for declining with a reason."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"space-y-6",children:[c.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:16,className:"text-red-500"}),e.jsx("h3",{className:"font-medium text-red-800",children:"Assignment Conflicts"})]}),e.jsx("ul",{className:"mt-2 text-red-700 list-disc list-inside",children:c.map((s,_)=>e.jsx("li",{children:s},_))})]}),e.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(I,{size:20,className:"text-blue-600"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Select Vehicle"})]}),a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(I,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No vehicles available for this time period"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a.map(s=>e.jsxs("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition ${i===s.id.toString()?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>Q(s.id.toString()),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.description}),i===s.id.toString()&&e.jsx(y,{size:20,className:"text-blue-500"})]}),e.jsx("p",{className:"text-gray-600",children:s.plate_number}),e.jsx("p",{className:"text-sm text-gray-500",children:s.fuel_type})]},s.id))}),b.vehicle_id&&e.jsx("p",{className:"mt-2 text-red-600 text-sm",children:b.vehicle_id})]}),e.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(O,{size:20,className:"text-green-600"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Select Driver"})]}),n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(O,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No drivers available for this time period"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:n.map(s=>e.jsxs("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition ${r===s.id.toString()?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>X(s.id.toString()),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),r===s.id.toString()&&e.jsx(y,{size:20,className:"text-green-500"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.contact_number})]},s.id))}),b.driver_id&&e.jsx("p",{className:"mt-2 text-red-600 text-sm",children:b.driver_id})]}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:j&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(re,{size:16,className:"animate-spin"}),e.jsx("span",{children:"Checking availability..."})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>F.visit(route("assignment.requests.index")),className:"px-8 py-3 bg-gray-500 text-white rounded hover:bg-gray-600",disabled:A||g,children:"Cancel"}),z?e.jsxs("button",{type:"button",onClick:Y,disabled:g,className:"px-8 py-3 bg-red-600 text-white rounded-md font-medium hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed transition flex items-center gap-2",children:[e.jsx(ne,{size:18}),"Forward for Decline"]}):e.jsx("button",{type:"button",onClick:B,disabled:!T,className:`px-8 py-3 rounded-md font-medium transition ${T?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Preview Assignment"})]})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Request Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Requester: "}),e.jsx("p",{className:"text-gray-900",children:t.user.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.user.department," - ",t.user.position]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(de,{size:16,className:"text-gray-500 mt-1"}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Destination"}),e.jsx("p",{className:"text-gray-900",children:t.destination})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ie,{size:16,className:"text-gray-500 mt-1"}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Schedule"}),e.jsx("p",{className:"text-gray-900",children:oe(t.start_datetime)}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Duration: ",t.days_of_travel," day(s)"]})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(le,{size:16,className:"text-gray-500 mt-1"}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Passengers"}),e.jsx("p",{className:"text-gray-900",children:t.authorized_passengers})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Purpose"}),e.jsx("p",{className:"text-gray-900",children:t.purpose})]})]})]})})]})]})}),e.jsx(ce,{isOpen:d,closeModal:()=>u(!1),request:t,selectedVehicle:W,selectedDriver:Z,assignmentAdmin:m.user,onConfirmAssignment:H,processing:A,previewUrl:U}),$&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(P,{className:"w-6 h-6 text-red-600"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Forward Request for Decline"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Please provide a reason for declining this request. This will be forwarded to the approval admin.",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:h,onChange:s=>D(s.target.value),placeholder:"Reason for declining the request",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 resize-none",rows:"4",maxLength:"500",required:!0}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:J,className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 text-sm font-medium rounded-md transition-colors",disabled:g,children:"Cancel"}),e.jsx("button",{onClick:K,disabled:!h.trim()||h.trim().length<5||g,className:"px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-red-300 disabled:cursor-not-allowed text-white text-sm font-medium rounded-md transition-colors",children:g?"Forwarding...":"Forward to Approval Admin"})]})]})})})]})}export{Ae as default};
